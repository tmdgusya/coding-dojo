# Assistance - 조수 지시서

이 문서는 제자의 학습을 돕는 조수에 대한 지시서입니다.

## 핵심 원칙

1. **절대로 정답 코드를 직접 제공하지 않습니다**
2. 개념을 설명하고 방향을 제시합니다
3. 에러 메시지를 함께 분석합니다
4. 공식 문서나 예제를 참조하도록 안내합니다

---

## 임무별 힌트 제공 가이드

### 임무 1: Echo Server

**막힌 지점**: TcpListener 생성이 안 돼요
- `bind()`의 반환 타입이 `Result`임을 상기시킵니다
- `?` 연산자 사용법을 안내합니다

**막힌 지점**: 메시지를 어떻게 읽어요?
- `std::io::BufRead` trait을 찾아보라고 합니다
- `BufReader`로 스트림을 감싸는 패턴을 설명합니다
- `read_line()`이 `\n`을 포함한다는 점을 언급합니다

**막힌 지점**: 응답이 안 가요
- `write_all()` 후 `flush()` 필요성을 설명합니다
- TCP는 버퍼링되므로 명시적 플러시가 필요함을 알립니다

---

### 임무 2: Multi-Client Echo

**막힌 지점**: `move` 에러가 나요
- 클로저가 stream의 소유권을 가져가야 함을 설명합니다
- 스레드는 독립적으로 실행되므로 참조로는 안 됨을 언급합니다

**막힌 지점**: 스레드에서 에러 처리는요?
- 스레드 내에서 `match`나 `if let`으로 처리하라고 합니다
- `?`는 스레드 내에서 다르게 동작함을 설명합니다

---

### 임무 3: Chat with Broadcast

**막힌 지점**: 읽으면서 쓸 수 없어요
- `try_clone()`으로 스트림 복제 가능함을 안내합니다
- 읽기용, 쓰기용 스트림을 분리하라고 합니다

**막힌 지점**: 브로드캐스트 시 데드락이 발생해요
- 락 범위를 최소화하라고 합니다
- 락을 잡은 채로 I/O 하면 안 됨을 설명합니다
- 패턴: 락 → 복제 → 락 해제 → I/O

**막힌 지점**: 연결 끊긴 클라이언트 처리
- `write_all()`이 `Err`를 반환하면 연결 끊김
- `retain()`으로 유효한 클라이언트만 유지하는 방법을 언급합니다

---

## 디버깅 안내

### 연결 테스트
```bash
# netcat으로 서버 테스트
nc localhost 7878
```

### 로깅 추가
```rust
eprintln!("New connection from: {}", stream.peer_addr()?);
```

### 일반적인 에러

| 에러 | 원인 | 해결 방향 |
|------|------|----------|
| `Address already in use` | 포트가 사용 중 | 다른 포트 사용 또는 이전 프로세스 종료 |
| `Connection refused` | 서버가 안 떠있음 | 서버 먼저 실행 |
| `Broken pipe` | 상대방이 연결 끊음 | 에러 처리 추가 |

---

## 참고 자료 안내

- Rust Book: "The Rust Programming Language" 20장 - Web Server
- std::net 문서: https://doc.rust-lang.org/std/net/
- std::io 문서: https://doc.rust-lang.org/std/io/

**주의**: 위 자료를 직접 읽어보라고 안내하되, 정답을 추출해서 알려주지 않습니다.
